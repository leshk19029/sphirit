local library = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/UI-Libs/main/Vape.txt"))()

local window = library:Window("Player Controller", Color3.fromRGB(44, 120, 224), Enum.KeyCode.RightControl)
local mainTab = window:Tab("Main")

local controlledPlayer = nil
local isControlling = false
local originalCFrame = nil

-- Speed Boost variables
local speedEnabled = false
local currentSpeed = 25
local velocityConnection = nil

-- Anti Effects variables
local antiEffectsEnabled = false
local antiEffectsConnection = nil

local function controlPlayer(player)
    if controlledPlayer and controlledPlayer.Character and controlledPlayer.Character:FindFirstChild("HumanoidRootPart") then
        game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame = originalCFrame
    end
    
    if player and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
        originalCFrame = game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame
        game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame = player.Character.HumanoidRootPart.CFrame
        controlledPlayer = player
        isControlling = true
        return true
    end
    return false
end

local function stopControl()
    if controlledPlayer and originalCFrame then
        game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame = originalCFrame
        controlledPlayer = nil
        isControlling = false
        originalCFrame = nil
    end
end

-- Speed Boost function
local function applyVelocity()
    if not speedEnabled then return end
    
    local player = game.Players.LocalPlayer
    local character = player.Character
    if not character then return end
    
    local humanoid = character:FindFirstChild("Humanoid")
    local rootPart = character:FindFirstChild("HumanoidRootPart")
    
    if humanoid and rootPart then
        local moveDirection = humanoid.MoveDirection
        if moveDirection.Magnitude > 0 then
            local velocity = moveDirection * currentSpeed
            rootPart.Velocity = Vector3.new(velocity.X, rootPart.Velocity.Y, velocity.Z)
        else
            rootPart.Velocity = Vector3.new(0, rootPart.Velocity.Y, 0)
        end
    end
end

local function toggleSpeedBoost(state)
    speedEnabled = state
    
    if speedEnabled then
        if velocityConnection then
            velocityConnection:Disconnect()
        end
        velocityConnection = game:GetService("RunService").RenderStepped:Connect(applyVelocity)
    else
        if velocityConnection then
            velocityConnection:Disconnect()
            velocityConnection = nil
        end
    end
end

-- Anti Effects function
local function setupAntiEffects()
    local lighting = game:GetService("Lighting")
    local camera = game:GetService("Workspace").CurrentCamera

    -- Функция для удаления DiscoEffect и настройки эффектов + фиксации FOV
    local function checkForDiscoEffect(child)
        if child.Name == "DiscoEffect" then
            child:Destroy() -- Удаляем DiscoEffect
            
            -- Удаляем Blur (если есть)
            local blur = lighting:FindFirstChild("Blur")
            if blur then
                blur:Destroy()
            end

            -- Включаем ColorCorrection (создаём, если нет)
            local correction = lighting:FindFirstChild("ColorCorrection") or Instance.new("ColorCorrection")
            correction.Parent = lighting
            correction.Enabled = true

            -- Фиксируем FieldOfView = 70 только при обнаружении DiscoEffect
            camera.FieldOfView = 70 -- Устанавливаем сразу
            
            -- Настраиваем отслеживание изменений FOV
            if not camera:GetPropertyChangedSignal("FieldOfView"):IsConnected() then
                camera:GetPropertyChangedSignal("FieldOfView"):Connect(function()
                    if camera.FieldOfView ~= 70 then
                        camera.FieldOfView = 70 -- Принудительно возвращаем
                    end
                end)
            end
        end
    end

    -- Проверяем существующие объекты (на случай, если DiscoEffect уже есть)
    for _, child in ipairs(lighting:GetChildren()) do
        checkForDiscoEffect(child)
    end

    -- Включаем отслеживание новых объектов
    lighting.ChildAdded:Connect(checkForDiscoEffect)

    local Players = game:GetService("Players")
    local Lighting = game:GetService("Lighting")
    local ReplicatedStorage = game:GetService("ReplicatedStorage")
    local RunService = game:GetService("RunService")

    local localPlayer = Players.LocalPlayer
    local playerScripts = localPlayer.PlayerScripts
    local camera = workspace.CurrentCamera

    -- Функция для восстановления управления и удаления эффектов
    local function restoreControls()
        -- Восстанавливаем FieldOfView камеры
        if camera then
            camera.FieldOfView = 70
        end
    end

    -- Функция для проверки и удаления эффектов
    local function checkEffects()
        -- Удаляем эффекты, если они есть
        for _, effectName in ipairs({"BeeBlur", "ColorCorrection"}) do
            local effect = Lighting:FindFirstChild(effectName)
            if effect then
                effect:Destroy()
            end
        end
    end

    -- Слушатель для новых эффектов в Lighting
    Lighting.ChildAdded:Connect(function(child)
        if child.Name == "BeeBlur" or child.Name == "ColorCorrection" then
            child:Destroy()
            restoreControls() -- Дополнительно восстанавливаем управление
        end
    end)

    -- Постоянная проверка
    antiEffectsConnection = RunService.Heartbeat:Connect(function()
        checkEffects()
        restoreControls() -- Постоянно восстанавливаем управление
    end)
end

local function toggleAntiEffects(state)
    antiEffectsEnabled = state
    
    if antiEffectsEnabled then
        setupAntiEffects()
    else
        if antiEffectsConnection then
            antiEffectsConnection:Disconnect()
            antiEffectsConnection = nil
        end
    end
end

-- Добавляем переключатель и слайдер для Speed Boost
mainTab:Toggle("Speed Boost", false, function(state)
    toggleSpeedBoost(state)
end)

mainTab:Slider("Speed Value", 1, 45, 25, function(value)
    currentSpeed = value
end)

-- Добавляем переключатель для Anti Effects
mainTab:Toggle("Anti Effects", false, function(state)
    toggleAntiEffects(state)
end)
