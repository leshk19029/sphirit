return function()
    local lighting = game:GetService("Lighting")
    local camera = game:GetService("Workspace").CurrentCamera
    local Players = game:GetService("Players")
    local ReplicatedStorage = game:GetService("ReplicatedStorage")
    local RunService = game:GetService("RunService")

    local localPlayer = Players.LocalPlayer
    local connections = {}
    local initialized = false

    -- Функция для удаления эффектов
    local function removeEffect(effectName)
        local effect = lighting:FindFirstChild(effectName)
        if effect then
            effect:Destroy()
            return true
        end
        return false
    end

    -- Функция для проверки DiscoEffect
    local function checkForDiscoEffect(child)
        if child.Name == "DiscoEffect" then
            child:Destroy()
            removeEffect("Blur")
            
            -- ColorCorrection
            local correction = lighting:FindFirstChild("ColorCorrection") or Instance.new("ColorCorrection")
            correction.Name = "ColorCorrection"
            correction.Parent = lighting
            correction.Enabled = true

            -- FieldOfView
            if camera then
                camera.FieldOfView = 70
            end
            return true
        end
        return false
    end

    -- Функция для восстановления управления
    local function restoreControls()
        local success, PlayerModule = pcall(function()
            return require(localPlayer.PlayerScripts:WaitForChild("PlayerModule"))
        end)
        
        if success and PlayerModule then
            local controls = PlayerModule:GetControls()
            if controls then
                local success2, CharacterController = pcall(function()
                    return require(ReplicatedStorage.Controllers.CharacterController)
                end)
                if success2 and CharacterController and CharacterController.originalMoveFunction then
                    controls.moveFunction = CharacterController.originalMoveFunction
                end
            end
        end
        
        -- Восстанавливаем FieldOfView
        if camera then
            camera.FieldOfView = 70
        end
    end

    -- Основная функция инициализации
    local function initializeAntiEffects()
        if initialized then return end
        initialized = true

        -- Проверяем существующие объекты
        for _, child in ipairs(lighting:GetChildren()) do
            if child.Name == "DiscoEffect" or child.Name == "BeeBlur" then
                checkForDiscoEffect(child)
            end
        end

        -- Слушатель для новых объектов
        table.insert(connections, lighting.ChildAdded:Connect(function(child)
            if child.Name == "DiscoEffect" or child.Name == "BeeBlur" or child.Name == "ColorCorrection" then
                if child.Name == "DiscoEffect" or child.Name == "BeeBlur" then
                    checkForDiscoEffect(child)
                else
                    child:Destroy()
                end
                restoreControls()
            end
        end))

        -- Слушатель для изменений FOV
        if camera then
            table.insert(connections, camera:GetPropertyChangedSignal("FieldOfView"):Connect(function()
                if camera.FieldOfView ~= 70 then
                    camera.FieldOfView = 70
                end
            end))
            camera.FieldOfView = 70
        end

        -- Периодическая проверка (каждые 3 секунды)
        local lastCheck = 0
        table.insert(connections, RunService.Heartbeat:Connect(function(deltaTime)
            lastCheck = lastCheck + deltaTime
            if lastCheck >= 3 then
                lastCheck = 0
                restoreControls()
                
                -- Быстрая проверка эффектов
                for _, name in ipairs({"DiscoEffect", "BeeBlur"}) do
                    local effect = lighting:FindFirstChild(name)
                    if effect then
                        effect:Destroy()
                    end
                end
            end
        end))

        -- Первоначальная проверка
        restoreControls()
    end

    -- Функция очистки
    local function cleanup()
        for _, connection in ipairs(connections) do
            connection:Disconnect()
        end
        connections = {}
        initialized = false
    end

    -- Запускаем инициализацию
    task.spawn(initializeAntiEffects)

    -- Возвращаем функцию очистки
    return cleanup
end
